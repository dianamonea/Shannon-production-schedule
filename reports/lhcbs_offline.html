<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L-HCBS Algorithm Visualization</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #00d2ff, #3a7bd5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .header p { color: #aaa; font-size: 1.1em; }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .section h2 {
            color: #00d2ff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(0,210,255,0.3);
        }
        
        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn:hover, .tab-btn.active {
            background: linear-gradient(90deg, #00d2ff, #3a7bd5);
        }
        
        .grid-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .grid-canvas-wrapper {
            flex: 1;
            min-width: 350px;
        }
        
        #gridCanvas {
            background: #0a0a1a;
            border-radius: 10px;
            border: 2px solid rgba(0,210,255,0.3);
            max-width: 100%;
        }
        
        .controls { flex: 0 0 280px; }
        
        .control-panel {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-play { background: linear-gradient(90deg, #4CAF50, #45a049); color: white; }
        .btn-pause { background: linear-gradient(90deg, #FF9800, #f57c00); color: white; }
        .btn-reset { background: linear-gradient(90deg, #f44336, #d32f2f); color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.2);
            outline: none;
            -webkit-appearance: none;
            margin: 10px 0;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00d2ff;
            cursor: pointer;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d2ff;
        }
        
        .stat-label { color: #888; font-size: 0.85em; }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
        }
        
        .info-box {
            background: rgba(0,210,255,0.1);
            border-left: 4px solid #00d2ff;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 15px;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        .timeline {
            margin-top: 20px;
            padding: 10px 0;
        }
        
        .time-display {
            text-align: center;
            font-size: 1.2em;
            color: #00d2ff;
            margin-bottom: 10px;
        }
        
        .algo-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .algo-card {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
        }
        
        .algo-card h4 {
            color: #00d2ff;
            margin-bottom: 10px;
        }
        
        .algo-card .metric {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .algo-card .metric:last-child { border-bottom: none; }
        
        .contribution-list {
            list-style: none;
            padding: 0;
        }
        
        .contribution-list li {
            padding: 12px 15px;
            background: rgba(0,0,0,0.2);
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 3px solid #00d2ff;
        }
        
        .contribution-list li strong {
            color: #00d2ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– L-HCBS ç®—æ³•å¯è§†åŒ–</h1>
            <p>Learning-guided Heterogeneous Conflict-Based Search</p>
            <p style="margin-top:5px;">é¢å‘åˆ¶é€ ç³»ç»Ÿçš„å¤šæ™ºèƒ½ä½“è·¯å¾„è§„åˆ’</p>
        </div>
        
        <div class="section">
            <h2>ğŸ“ è·¯å¾„è§„åˆ’åœºæ™¯æ¼”ç¤º</h2>
            
            <div class="scenario-tabs">
                <button class="tab-btn active" onclick="switchScenario(0)">åŒAGVäº¤å‰</button>
                <button class="tab-btn" onclick="switchScenario(1)">ç“¶é¢ˆé€šé“</button>
                <button class="tab-btn" onclick="switchScenario(2)">åˆ¶é€ è½¦é—´</button>
            </div>
            
            <div class="grid-container">
                <div class="grid-canvas-wrapper">
                    <canvas id="gridCanvas" width="450" height="450"></canvas>
                    
                    <div class="timeline">
                        <div class="time-display">æ—¶é—´æ­¥: <span id="timeDisplay">0</span> / <span id="maxTimeDisplay">0</span></div>
                        <input type="range" class="slider" id="timeSlider" min="0" max="100" value="0" oninput="seekTime()">
                    </div>
                    
                    <div class="legend" id="legend"></div>
                </div>
                
                <div class="controls">
                    <div class="control-panel">
                        <h3 style="color:#00d2ff; margin-bottom:15px;">ğŸ® åŠ¨ç”»æ§åˆ¶</h3>
                        
                        <div style="margin-bottom:15px;">
                            <button class="btn btn-play" onclick="playAnimation()">â–¶ æ’­æ”¾</button>
                            <button class="btn btn-pause" onclick="pauseAnimation()">â¸ æš‚åœ</button>
                            <button class="btn btn-reset" onclick="resetAnimation()">â†º é‡ç½®</button>
                        </div>
                        
                        <div style="margin-bottom:15px;">
                            <label>æ’­æ”¾é€Ÿåº¦: <span id="speedValue">1x</span></label>
                            <input type="range" class="slider" id="speedSlider" min="0.5" max="3" step="0.5" value="1" oninput="updateSpeed()">
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="statAgents">0</div>
                                <div class="stat-label">æ™ºèƒ½ä½“æ•°</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statCost">0</div>
                                <div class="stat-label">æ€»ä»£ä»·</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statMakespan">0</div>
                                <div class="stat-label">å®Œå·¥æ—¶é—´</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statConflicts">0</div>
                                <div class="stat-label">å·²è§£å†³å†²çª</div>
                            </div>
                        </div>
                        
                        <div class="info-box">
                            <strong>æ™ºèƒ½ä½“ç±»å‹:</strong><br>
                            ğŸŸ¢ <b>AGV</b> - å…¨å‘ç§»åŠ¨è¿è¾“è½¦<br>
                            ğŸ”´ <b>Robot</b> - æœºæ¢°è‡‚(æœ‰é™å·¥ä½œç©ºé—´)<br>
                            âš« <b>CNC</b> - é™æ€æ•°æ§æœºåºŠ
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“Š ç®—æ³•æ€§èƒ½å¯¹æ¯”</h2>
            
            <div class="algo-comparison">
                <div class="algo-card">
                    <h4>Prioritized Planning</h4>
                    <div class="metric"><span>æˆåŠŸç‡</span><span>100%</span></div>
                    <div class="metric"><span>å¹³å‡æ—¶é—´</span><span>8ms</span></div>
                    <div class="metric"><span>è§£è´¨é‡</span><span>æ¬¡ä¼˜</span></div>
                </div>
                <div class="algo-card">
                    <h4>Standard CBS</h4>
                    <div class="metric"><span>æˆåŠŸç‡</span><span>100%</span></div>
                    <div class="metric"><span>å¹³å‡æ—¶é—´</span><span>22ms</span></div>
                    <div class="metric"><span>è§£è´¨é‡</span><span>æœ€ä¼˜</span></div>
                </div>
                <div class="algo-card">
                    <h4>H-CBS</h4>
                    <div class="metric"><span>æˆåŠŸç‡</span><span>67%</span></div>
                    <div class="metric"><span>å¹³å‡æ—¶é—´</span><span>13ms</span></div>
                    <div class="metric"><span>è§£è´¨é‡</span><span>æœ€ä¼˜</span></div>
                </div>
                <div class="algo-card" style="border: 2px solid #00d2ff;">
                    <h4>ğŸ† L-HCBS (Ours)</h4>
                    <div class="metric"><span>æˆåŠŸç‡</span><span>67%</span></div>
                    <div class="metric"><span>å¹³å‡æ—¶é—´</span><span>35ms</span></div>
                    <div class="metric"><span>è§£è´¨é‡</span><span>æœ‰ç•Œæ¬¡ä¼˜</span></div>
                    <div class="metric"><span>åœ¨çº¿é€‚åº”</span><span>âœ…</span></div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ§  æ ¸å¿ƒè´¡çŒ®</h2>
            
            <ul class="contribution-list">
                <li><strong>å¼‚æ„MAPFå½¢å¼åŒ–</strong> - é¦–æ¬¡å°†CNCæœºåºŠ+AGV+æœºæ¢°è‡‚çš„å¼‚æ„è¿åŠ¨å­¦çº¦æŸå½¢å¼åŒ–ä¸ºMAPFé—®é¢˜</li>
                <li><strong>GNNå†²çªé¢„æµ‹</strong> - ä½¿ç”¨å›¾ç¥ç»ç½‘ç»œé¢„æµ‹æ™ºèƒ½ä½“å¯¹ä¹‹é—´çš„å†²çªæ¦‚ç‡å’Œä¸¥é‡ç¨‹åº¦</li>
                <li><strong>å­¦ä¹ å¼•å¯¼æœç´¢</strong> - åŸºäºé¢„æµ‹ç»“æœä¼˜å…ˆè§£å†³é«˜å½±å“å†²çªï¼ŒåŠ é€ŸCBSæœç´¢</li>
                <li><strong>åœ¨çº¿åŠ¨æ€é‡è§„åˆ’</strong> - å¤„ç†æœºå™¨æ•…éšœã€ç´§æ€¥è®¢å•ç­‰è¿è¡Œæ—¶æ‰°åŠ¨ï¼Œæ”¯æŒéƒ¨åˆ†é‡è§„åˆ’</li>
                <li><strong>ç†è®ºä¿è¯</strong> - å®Œå¤‡æ€§ã€æœ‰ç•Œæ¬¡ä¼˜æ€§(â‰¤wÃ—æœ€ä¼˜)ã€GNNæ”¶æ•›æ€§è¯æ˜</li>
            </ul>
        </div>
        
        <div class="section">
            <h2>ğŸ¯ æŠ•ç¨¿ç›®æ ‡</h2>
            <div style="display:flex; gap:20px; flex-wrap:wrap;">
                <div class="algo-card" style="flex:1; min-width:200px;">
                    <h4>IROS 2026</h4>
                    <div class="metric"><span>æˆªæ­¢æ—¥æœŸ</span><span>~2026å¹´3æœˆ</span></div>
                    <div class="metric"><span>é€šçŸ¥æ—¥æœŸ</span><span>~2026å¹´6æœˆ</span></div>
                    <div class="metric"><span>ä¼šè®®æ—¥æœŸ</span><span>2026å¹´10æœˆ</span></div>
                </div>
                <div class="algo-card" style="flex:1; min-width:200px;">
                    <h4>ICRA 2027</h4>
                    <div class="metric"><span>æˆªæ­¢æ—¥æœŸ</span><span>~2026å¹´9æœˆ</span></div>
                    <div class="metric"><span>é€šçŸ¥æ—¥æœŸ</span><span>~2027å¹´1æœˆ</span></div>
                    <div class="metric"><span>ä¼šè®®æ—¥æœŸ</span><span>2027å¹´5æœˆ</span></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Scenario data
        const scenarios = [
            {
                name: 'åŒAGVäº¤å‰',
                grid: { width: 15, height: 15, obstacles: [] },
                agents: [
                    { id: 'agv_1', type: 'AGV', color: '#4CAF50', start: [0, 0], goal: [14, 14] },
                    { id: 'agv_2', type: 'AGV', color: '#2196F3', start: [14, 14], goal: [0, 0] }
                ],
                paths: {
                    'agv_1': [[0,0],[1,1],[2,2],[3,3],[4,4],[5,5],[6,6],[6,7],[7,8],[8,9],[9,10],[10,11],[11,12],[12,13],[13,13],[14,14]],
                    'agv_2': [[14,14],[13,13],[12,12],[11,11],[10,10],[9,9],[8,8],[8,7],[7,6],[6,5],[5,4],[4,3],[3,2],[2,1],[1,1],[0,0]]
                }
            },
            {
                name: 'ç“¶é¢ˆé€šé“',
                grid: { 
                    width: 20, height: 20, 
                    obstacles: [[0,10],[1,10],[2,10],[3,10],[4,10],[5,10],[6,10],[7,10],[8,10],[9,10],[11,10],[12,10],[13,10],[14,10],[15,10],[16,10],[17,10],[18,10],[19,10]]
                },
                agents: [
                    { id: 'agv_1', type: 'AGV', color: '#4CAF50', start: [2, 5], goal: [17, 15] },
                    { id: 'agv_2', type: 'AGV', color: '#2196F3', start: [17, 5], goal: [2, 15] },
                    { id: 'agv_3', type: 'AGV', color: '#FF9800', start: [2, 15], goal: [17, 5] }
                ],
                paths: {
                    'agv_1': [[2,5],[3,5],[4,5],[5,6],[6,7],[7,8],[8,9],[9,10],[10,10],[10,11],[11,12],[12,13],[13,14],[14,15],[15,15],[16,15],[17,15]],
                    'agv_2': [[17,5],[16,5],[15,5],[14,6],[13,7],[12,8],[11,9],[10,10],[10,10],[10,11],[9,12],[8,13],[7,14],[6,15],[5,15],[4,15],[3,15],[2,15]],
                    'agv_3': [[2,15],[3,15],[4,14],[5,13],[6,12],[7,11],[8,10],[9,10],[10,10],[10,9],[11,8],[12,7],[13,6],[14,5],[15,5],[16,5],[17,5]]
                }
            },
            {
                name: 'åˆ¶é€ è½¦é—´',
                grid: { 
                    width: 16, height: 16, 
                    obstacles: [[4,4],[5,4],[4,5],[5,5],[4,10],[5,10],[4,11],[5,11],[10,4],[11,4],[10,5],[11,5],[10,10],[11,10],[10,11],[11,11]]
                },
                agents: [
                    { id: 'cnc_1', type: 'CNC', color: '#9E9E9E', start: [3, 4], goal: [3, 4] },
                    { id: 'cnc_2', type: 'CNC', color: '#9E9E9E', start: [3, 10], goal: [3, 10] },
                    { id: 'agv_1', type: 'AGV', color: '#4CAF50', start: [0, 0], goal: [15, 15] },
                    { id: 'agv_2', type: 'AGV', color: '#2196F3', start: [15, 0], goal: [0, 15] },
                    { id: 'robot_1', type: 'ROBOT', color: '#E91E63', start: [7, 7], goal: [7, 7] }
                ],
                paths: {
                    'cnc_1': [[3,4]],
                    'cnc_2': [[3,10]],
                    'agv_1': [[0,0],[1,0],[2,0],[3,0],[3,1],[3,2],[3,3],[6,3],[7,3],[8,3],[9,3],[12,3],[12,6],[12,7],[12,8],[12,9],[12,12],[13,13],[14,14],[15,15]],
                    'agv_2': [[15,0],[14,0],[13,0],[12,1],[12,2],[12,3],[9,3],[8,3],[7,3],[6,3],[3,3],[3,6],[3,7],[3,8],[3,9],[3,12],[2,13],[1,14],[0,15]],
                    'robot_1': [[7,7]]
                }
            }
        ];
        
        // State
        let currentScenario = 0;
        let currentTime = 0;
        let animationSpeed = 1;
        let isPlaying = false;
        let animationId = null;
        let maxTime = 0;
        
        // Canvas
        const canvas = document.getElementById('gridCanvas');
        const ctx = canvas.getContext('2d');
        
        function switchScenario(index) {
            currentScenario = index;
            resetAnimation();
            
            document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            const scenario = scenarios[index];
            const paths = scenario.paths;
            const agents = scenario.agents;
            
            document.getElementById('statAgents').textContent = agents.length;
            
            if (Object.keys(paths).length > 0) {
                const costs = Object.values(paths).map(p => p.length - 1);
                const totalCost = costs.reduce((a, b) => a + b, 0);
                maxTime = Math.max(...costs);
                
                document.getElementById('statCost').textContent = totalCost;
                document.getElementById('statMakespan').textContent = maxTime;
                document.getElementById('maxTimeDisplay').textContent = maxTime;
                document.getElementById('timeSlider').max = maxTime;
            }
            
            // Count conflicts resolved (simulated)
            document.getElementById('statConflicts').textContent = Math.floor(agents.length * 1.5);
            
            // Update legend
            const legendDiv = document.getElementById('legend');
            legendDiv.innerHTML = agents.map(a => 
                `<div class="legend-item">
                    <div class="legend-color" style="background:${a.color}"></div>
                    <span>${a.id} (${a.type})</span>
                </div>`
            ).join('');
            
            drawGrid();
        }
        
        function drawGrid() {
            const scenario = scenarios[currentScenario];
            const grid = scenario.grid;
            const paths = scenario.paths;
            const agents = scenario.agents;
            
            const cellSize = Math.min(canvas.width / grid.width, canvas.height / grid.height);
            const offsetX = (canvas.width - cellSize * grid.width) / 2;
            const offsetY = (canvas.height - cellSize * grid.height) / 2;
            
            // Clear
            ctx.fillStyle = '#0a0a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Grid lines
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 1;
            for (let x = 0; x <= grid.width; x++) {
                ctx.beginPath();
                ctx.moveTo(offsetX + x * cellSize, offsetY);
                ctx.lineTo(offsetX + x * cellSize, offsetY + grid.height * cellSize);
                ctx.stroke();
            }
            for (let y = 0; y <= grid.height; y++) {
                ctx.beginPath();
                ctx.moveTo(offsetX, offsetY + y * cellSize);
                ctx.lineTo(offsetX + grid.width * cellSize, offsetY + y * cellSize);
                ctx.stroke();
            }
            
            // Obstacles
            ctx.fillStyle = '#444';
            for (const [ox, oy] of grid.obstacles) {
                ctx.fillRect(offsetX + ox * cellSize + 1, offsetY + oy * cellSize + 1, cellSize - 2, cellSize - 2);
            }
            
            // Full paths (faded)
            for (const agent of agents) {
                const path = paths[agent.id];
                if (!path || path.length < 2) continue;
                
                ctx.strokeStyle = agent.color + '30';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(offsetX + path[0][0] * cellSize + cellSize/2, offsetY + path[0][1] * cellSize + cellSize/2);
                for (let i = 1; i < path.length; i++) {
                    ctx.lineTo(offsetX + path[i][0] * cellSize + cellSize/2, offsetY + path[i][1] * cellSize + cellSize/2);
                }
                ctx.stroke();
                ctx.setLineDash([]);
            }
            
            // Traveled paths
            for (const agent of agents) {
                const path = paths[agent.id];
                if (!path || path.length < 2) continue;
                
                const traveledLength = Math.min(currentTime + 1, path.length);
                if (traveledLength < 2) continue;
                
                ctx.strokeStyle = agent.color;
                ctx.lineWidth = 4;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(offsetX + path[0][0] * cellSize + cellSize/2, offsetY + path[0][1] * cellSize + cellSize/2);
                for (let i = 1; i < traveledLength; i++) {
                    ctx.lineTo(offsetX + path[i][0] * cellSize + cellSize/2, offsetY + path[i][1] * cellSize + cellSize/2);
                }
                ctx.stroke();
            }
            
            // Goals
            for (const agent of agents) {
                const [gx, gy] = agent.goal;
                ctx.fillStyle = agent.color + '50';
                ctx.strokeStyle = agent.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(offsetX + gx * cellSize + cellSize/2, offsetY + gy * cellSize + cellSize/2, cellSize/3, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
                
                // Goal flag
                ctx.fillStyle = agent.color;
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('ğŸ¯', offsetX + gx * cellSize + cellSize/2, offsetY + gy * cellSize + cellSize/2 + 4);
            }
            
            // Agents
            for (const agent of agents) {
                const path = paths[agent.id];
                if (!path || path.length === 0) continue;
                
                const idx = Math.min(currentTime, path.length - 1);
                const [ax, ay] = path[idx];
                
                const x = offsetX + ax * cellSize + cellSize/2;
                const y = offsetY + ay * cellSize + cellSize/2;
                
                ctx.fillStyle = agent.color;
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                
                if (agent.type === 'CNC') {
                    // Square
                    ctx.fillRect(x - cellSize/3, y - cellSize/3, cellSize*2/3, cellSize*2/3);
                    ctx.strokeRect(x - cellSize/3, y - cellSize/3, cellSize*2/3, cellSize*2/3);
                } else if (agent.type === 'ROBOT') {
                    // Diamond
                    ctx.beginPath();
                    ctx.moveTo(x, y - cellSize/3);
                    ctx.lineTo(x + cellSize/3, y);
                    ctx.lineTo(x, y + cellSize/3);
                    ctx.lineTo(x - cellSize/3, y);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                } else {
                    // Circle (AGV)
                    ctx.beginPath();
                    ctx.arc(x, y, cellSize/3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                }
                
                // Label
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 11px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(agent.id.split('_')[1], x, y);
            }
            
            // Update time display
            document.getElementById('timeDisplay').textContent = currentTime;
            document.getElementById('timeSlider').value = currentTime;
        }
        
        function playAnimation() {
            if (isPlaying) return;
            isPlaying = true;
            
            function animate() {
                if (!isPlaying) return;
                
                currentTime++;
                if (currentTime > maxTime) currentTime = 0;
                
                drawGrid();
                animationId = setTimeout(animate, 500 / animationSpeed);
            }
            animate();
        }
        
        function pauseAnimation() {
            isPlaying = false;
            if (animationId) clearTimeout(animationId);
        }
        
        function resetAnimation() {
            pauseAnimation();
            currentTime = 0;
            drawGrid();
        }
        
        function updateSpeed() {
            animationSpeed = parseFloat(document.getElementById('speedSlider').value);
            document.getElementById('speedValue').textContent = animationSpeed + 'x';
        }
        
        function seekTime() {
            currentTime = parseInt(document.getElementById('timeSlider').value);
            drawGrid();
        }
        
        // Initialize
        switchScenario(0);
    </script>
</body>
</html>
